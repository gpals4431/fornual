<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper	namespace="com.fornula.domain.expert.mapper.java.ExpertSalesMapper">
	<!-- 검색필터를 이용한 검색 -->
	<!-- <select id="selectSearchSalesList" resultType="ItemSales">
		SELECT SALES.sales_idx,
				SALES.sales_date,
				SALES.sales_status,
				ITEM.item_name,
				ITEM.item_idx,
				ITEM.price,
				ITEM.item_content
		FROM sales SALES
   		JOIN item ITEM 
   		ON SALES.item_idx = ITEM.item_idx
   		WHERE SALES.sales_status = #{salesStatus}
    	AND SALES.sales_date = #{salesDate}
        ORDER BY SALES.sales_date
	</select> -->
	
	<!-- 판매내역 출력-->
	<select id="selectSalesList" resultType="SaleItemExpert">
		SELECT * FROM(SELECT rownum rn, saleslist.* FROM
				(SELECT S.sales_idx,
                S.sales_date,
                S.sales_status,
                I.item_idx,
                I.item_name,
                I.price,
                I.item_content,
                P.itemfile_name,
                ST.status
        FROM item I
        LEFT JOIN sales S ON I.item_idx = S.item_idx
        LEFT JOIN photo P ON I.item_idx = P.item_idx
        LEFT JOIN status ST ON S.sales_status =ST.status_idx
        WHERE I.expert_idx = #{expertIdx} AND I.item_status=1 AND S.sales_idx is not null
        ORDER BY S.sales_date
        ) saleslist)
        WHERE rn BETWEEN #{startRow} AND #{endRow}
	</select>
 
 	<!-- 판매내역 상태를 위한 객체 출력 -->
 	<select id="selectStatus" resultType="Sales">
 		SELECT * FROM sales
 		WHERE sales_idx=#{salesIdx};
 	</select>
 
 	<!-- 페이징 처리를 위한 count 검색 쿼리  -->
 	<select id="selectSalesCount" resultType="int">
 		SELECT COUNT(*)
 		FROM sales
 	</select>
 	
 	<!-- 총금액 출력을 위한 쿼리문 -->
 	<select id="selectTotalMoney" resultType="TotalSalesMoney">
 		SELECT S.sales_idx,
                S.sales_date,
                S.sales_status,
                I.item_idx,
                I.item_name,
                I.price,
                I.item_content
        FROM sales S
        JOIN item I ON S.item_idx = I.item_idx
        WHERE I.expert_idx = #{expertIdx} and I.item_status=1
        ORDER BY S.sales_date
    </select>
 	
 
	<!-- 상태 버튼 클릭시 판매 상태 변경 --> 
	<update id="updateSalesStatus" parameterType="Status">
	 	UPDATE sales
	 	SET sales_status =#{salesStatus}
		where sales_idx = #{salesIdx};
	</update>
 </mapper>




